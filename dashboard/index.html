<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rover ‚Äî Network Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: { extend: { fontFamily: { sans: ['Inter', 'system-ui'] } } }
        }
    </script>
    <style>
        body { background: #06080f; font-family: 'Inter', sans-serif; }
        .glass { background: rgba(12, 17, 30, 0.8); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.04); }
        .glow-c { box-shadow: 0 0 30px rgba(6, 182, 212, 0.1); }
        .glow-p { box-shadow: 0 0 30px rgba(139, 92, 246, 0.1); }
        .glow-t { box-shadow: 0 0 30px rgba(20, 184, 166, 0.1); }
        .glow-a { box-shadow: 0 0 30px rgba(245, 158, 11, 0.1); }
        .stat:hover { transform: translateY(-2px); transition: all 0.2s; }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:translateY(0)} }
        ::-webkit-scrollbar { width: 5px; } ::-webkit-scrollbar-track { background: #06080f; } ::-webkit-scrollbar-thumb { background: #1a2235; border-radius: 3px; }
        .tab-on { border-bottom: 2px solid #06b6d4; color: #06b6d4; }
        .tab-off { border-bottom: 2px solid transparent; color: #4b5563; }
        .tab-off:hover { color: #9ca3af; }
        .row:hover { background: rgba(6,182,212,0.03); }
        .bar { transition: width 0.6s ease-out; }
        .gradient-text { background: linear-gradient(135deg, #06b6d4, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body class="text-gray-300 min-h-screen">
    <!-- Header -->
    <header class="sticky top-0 z-50 glass border-b border-white/5">
        <div class="max-w-[1400px] mx-auto px-6 py-3.5 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-cyan-500 to-violet-500 flex items-center justify-center text-white font-bold text-xs">R</div>
                <div>
                    <h1 class="text-base font-semibold text-white tracking-tight">Rover</h1>
                    <p class="text-[10px] text-gray-500 -mt-0.5">Network Intelligence</p>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <span class="pulse w-1.5 h-1.5 rounded-full bg-emerald-400 inline-block"></span>
                <span id="status" class="text-[10px] text-gray-500">Live</span>
                <button onclick="refreshAll()" class="ml-2 px-2.5 py-1 rounded-md bg-white/5 hover:bg-white/10 text-[10px] text-gray-400 hover:text-white transition">‚Üª</button>
            </div>
        </div>
    </header>

    <main class="max-w-[1400px] mx-auto px-6 py-5 space-y-5">
        <!-- Hero Stats -->
        <div id="hero" class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-8 gap-3 fade-in"></div>

        <!-- Tabs -->
        <div class="flex gap-5 border-b border-white/5">
            <button onclick="tab('network')" id="t-network" class="tab-on pb-2.5 text-xs font-medium">Network</button>
            <button onclick="tab('contacts')" id="t-contacts" class="tab-off pb-2.5 text-xs font-medium">Contacts</button>
            <button onclick="tab('intros')" id="t-intros" class="tab-off pb-2.5 text-xs font-medium">Introductions</button>
            <button onclick="tab('activity')" id="t-activity" class="tab-off pb-2.5 text-xs font-medium">Activity</button>
            <button onclick="tab('followups')" id="t-followups" class="tab-off pb-2.5 text-xs font-medium">Follow-ups</button>
        </div>

        <!-- NETWORK TAB -->
        <div id="p-network" class="tab-content space-y-5">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-5">
                <div class="glass rounded-xl p-5 glow-c">
                    <h3 class="text-[11px] font-medium text-gray-500 uppercase tracking-wider mb-3">Contact Types</h3>
                    <canvas id="ch-types" height="200"></canvas>
                </div>
                <div class="glass rounded-xl p-5 glow-p">
                    <h3 class="text-[11px] font-medium text-gray-500 uppercase tracking-wider mb-3">Relationship Scores</h3>
                    <canvas id="ch-scores" height="200"></canvas>
                </div>
                <div class="glass rounded-xl p-5 glow-t">
                    <h3 class="text-[11px] font-medium text-gray-500 uppercase tracking-wider mb-3">Industries</h3>
                    <canvas id="ch-industries" height="200"></canvas>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-5">
                <div class="glass rounded-xl p-5 glow-a">
                    <h3 class="text-[11px] font-medium text-gray-500 uppercase tracking-wider mb-3">Relationship Stages</h3>
                    <canvas id="ch-stages" height="160"></canvas>
                </div>
                <div class="glass rounded-xl p-5">
                    <h3 class="text-[11px] font-medium text-gray-500 uppercase tracking-wider mb-3">Network Intelligence</h3>
                    <div id="intel" class="space-y-3"></div>
                </div>
            </div>
        </div>

        <!-- CONTACTS TAB -->
        <div id="p-contacts" class="tab-content hidden">
            <div class="glass rounded-xl p-5 overflow-x-auto">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-medium text-white">All Contacts</h3>
                    <input id="contact-search" type="text" placeholder="Search..." class="bg-white/5 border border-white/10 rounded-lg px-3 py-1.5 text-xs text-white w-48 focus:outline-none focus:border-cyan-500/30" oninput="filterContacts()">
                </div>
                <table class="w-full text-xs" id="contacts-table">
                    <thead><tr class="text-[10px] text-gray-500 uppercase tracking-wider border-b border-white/5">
                        <th class="text-left py-2 px-2">Name</th>
                        <th class="text-left py-2 px-2">Title</th>
                        <th class="text-left py-2 px-2">Company</th>
                        <th class="text-left py-2 px-2">Type</th>
                        <th class="text-left py-2 px-2">Score</th>
                        <th class="text-left py-2 px-2">Stage</th>
                        <th class="text-left py-2 px-2">Interactions</th>
                        <th class="text-left py-2 px-2">Email</th>
                        <th class="text-left py-2 px-2">Follow-up</th>
                    </tr></thead>
                    <tbody id="contacts-body"></tbody>
                </table>
            </div>
        </div>

        <!-- INTRODUCTIONS TAB -->
        <div id="p-intros" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-5 mb-5">
                <div class="glass rounded-xl p-5 glow-c">
                    <h3 class="text-[11px] font-medium text-gray-500 uppercase tracking-wider mb-3">Intro Status</h3>
                    <canvas id="ch-intro-status" height="180"></canvas>
                </div>
                <div class="lg:col-span-2 glass rounded-xl p-5">
                    <h3 class="text-[11px] font-medium text-gray-500 uppercase tracking-wider mb-3">Recent Introductions</h3>
                    <div id="intros-list" class="space-y-2 max-h-64 overflow-y-auto"></div>
                </div>
            </div>
        </div>

        <!-- ACTIVITY TAB -->
        <div id="p-activity" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-5">
                <div class="glass rounded-xl p-5 glow-c">
                    <h3 class="text-[11px] font-medium text-gray-500 uppercase tracking-wider mb-3">Interactions Over Time</h3>
                    <canvas id="ch-timeline" height="200"></canvas>
                </div>
                <div class="glass rounded-xl p-5 glow-p">
                    <h3 class="text-[11px] font-medium text-gray-500 uppercase tracking-wider mb-3">Interaction Types</h3>
                    <canvas id="ch-itypes" height="200"></canvas>
                </div>
            </div>
            <div class="glass rounded-xl p-5 mt-5">
                <h3 class="text-[11px] font-medium text-gray-500 uppercase tracking-wider mb-3">Most Interacted Contacts</h3>
                <div id="top-contacts" class="space-y-2"></div>
            </div>
        </div>

        <!-- FOLLOW-UPS TAB -->
        <div id="p-followups" class="tab-content hidden">
            <div class="glass rounded-xl p-5">
                <h3 class="text-sm font-medium text-white mb-4">Follow-up Tracker</h3>
                <div id="followups-list" class="space-y-2"></div>
            </div>
        </div>
    </main>

    <footer class="max-w-[1400px] mx-auto px-6 py-6 text-center text-[10px] text-gray-700">
        Rover Network Agent v3 ‚Ä¢ Built by Daisuke üê¢
    </footer>

    <script>
        Chart.defaults.color = '#4b5563';
        Chart.defaults.borderColor = 'rgba(255,255,255,0.03)';
        Chart.defaults.font.family = 'Inter';
        Chart.defaults.font.size = 10;

        const C = {cyan:'#06b6d4',teal:'#14b8a6',purple:'#8b5cf6',pink:'#ec4899',amber:'#f59e0b',emerald:'#10b981',red:'#ef4444',blue:'#3b82f6',indigo:'#6366f1',sky:'#0ea5e9'};
        const PAL = [C.cyan,C.teal,C.purple,C.pink,C.amber,C.emerald,C.blue,C.indigo,C.sky,C.red];
        let charts = {}, allContacts = [];

        function tab(t) {
            document.querySelectorAll('.tab-content').forEach(e=>e.classList.add('hidden'));
            document.querySelectorAll('[id^="t-"]').forEach(e=>e.className='tab-off pb-2.5 text-xs font-medium');
            document.getElementById('p-'+t).classList.remove('hidden');
            document.getElementById('t-'+t).className='tab-on pb-2.5 text-xs font-medium';
        }

        async function api(ep) { try { return await (await fetch('/api/'+ep)).json(); } catch(e) { return null; } }

        function mkChart(id,type,data,opts={}) {
            if(charts[id]) charts[id].destroy();
            const ctx=document.getElementById(id);
            if(!ctx) return;
            charts[id]=new Chart(ctx,{type,data,options:{
                responsive:true,maintainAspectRatio:false,
                plugins:{legend:{display:opts.legend!==false,labels:{boxWidth:8,padding:8,font:{size:10}}}},
                scales:type==='doughnut'||type==='pie'?{}:{
                    x:{grid:{display:false},ticks:{maxTicksLimit:10,font:{size:9}}},
                    y:{grid:{color:'rgba(255,255,255,0.02)'},beginAtZero:true,ticks:{font:{size:9}}}
                },...opts
            }});
        }

        function stat(label,value,icon,color,glow='') {
            return `<div class="stat glass rounded-xl p-3.5 ${glow} cursor-default">
                <div class="flex items-center gap-1.5 mb-1.5"><span class="text-sm">${icon}</span><span class="text-[9px] text-gray-500 uppercase tracking-wider">${label}</span></div>
                <p class="text-xl font-bold ${color}">${value}</p>
            </div>`;
        }

        function scoreBadge(s) {
            s=s||0;const c=s>=70?'emerald':s>=40?'amber':'red';
            return `<div class="flex items-center gap-1.5"><span class="text-${c}-400 font-semibold">${s}</span><div class="w-12 h-1 rounded-full bg-white/10"><div class="bar h-full rounded-full bg-${c}-400" style="width:${s}%"></div></div></div>`;
        }

        function stageBadge(s) {
            const colors={new:'blue',building:'cyan',strong:'emerald',dormant:'yellow',lost:'red'};
            const c=colors[s]||'gray';
            return `<span class="px-1.5 py-0.5 rounded text-[9px] bg-${c}-500/10 text-${c}-400">${s||'new'}</span>`;
        }

        function timeAgo(ts) {
            if(!ts) return '‚Äî';
            const d=(Date.now()-new Date(ts+'Z').getTime())/1000;
            if(d<60) return 'now'; if(d<3600) return Math.floor(d/60)+'m'; if(d<86400) return Math.floor(d/3600)+'h'; return Math.floor(d/86400)+'d';
        }

        async function loadHero() {
            const [ov,intel]=await Promise.all([api('overview'),api('intelligence')]);
            if(!ov) return;
            document.getElementById('hero').innerHTML=[
                stat('Contacts',intel?.total_contacts||0,'üë•','text-cyan-400','glow-c'),
                stat('Interactions',ov.total_interactions,'üí¨','text-teal-400','glow-t'),
                stat('Health',intel?.network_health||0,'‚ù§Ô∏è','text-purple-400','glow-p'),
                stat('Follow-ups',ov.pending_follow_ups,'üìÖ','text-amber-400','glow-a'),
                stat('Enriched',(intel?.enrichment_rate||0)+'%','üî¨','text-emerald-400'),
                stat('Has Email',(intel?.email_rate||0)+'%','üìß','text-sky-400'),
                stat('Active',intel?.active_relationships||0,'üü¢','text-green-400'),
                stat('Industries',intel?.industries_count||0,'üè≠','text-indigo-400'),
            ].join('');
        }

        async function loadNetwork() {
            const data=await api('contacts');
            if(!data||data.error) return;
            allContacts=data.contacts||[];

            // Types chart
            const cls=data.classifications||{};
            mkChart('ch-types','doughnut',{labels:Object.keys(cls),datasets:[{data:Object.values(cls),backgroundColor:PAL,borderWidth:0}]},{cutout:'60%'});

            // Scores
            const sd=data.score_distribution||{};
            mkChart('ch-scores','bar',{labels:Object.keys(sd),datasets:[{label:'Contacts',data:Object.values(sd),backgroundColor:[C.red+'80',C.amber+'80',C.cyan+'80',C.teal+'80',C.emerald+'80'],borderRadius:4}]});

            // Industries
            const ind=data.industries||{};
            mkChart('ch-industries','bar',{labels:Object.keys(ind).map(s=>s.length>12?s.slice(0,12)+'‚Ä¶':s),datasets:[{data:Object.values(ind),backgroundColor:PAL.map(c=>c+'80'),borderRadius:4}]},{indexAxis:'y'});

            // Stages
            const st=data.stages||{};
            const stageColors={new:C.blue+'80',building:C.cyan+'80',strong:C.emerald+'80',dormant:C.amber+'80',lost:C.red+'80'};
            mkChart('ch-stages','doughnut',{labels:Object.keys(st),datasets:[{data:Object.values(st),backgroundColor:Object.keys(st).map(s=>stageColors[s]||C.purple+'80'),borderWidth:0}]},{cutout:'60%'});

            // Intelligence panel
            const intel=await api('intelligence');
            if(intel&&!intel.error) {
                const el=document.getElementById('intel');
                el.innerHTML=`
                    <div class="flex justify-between py-2 border-b border-white/5"><span class="text-gray-400">Network Health Score</span><span class="text-white font-semibold gradient-text">${intel.network_health}/100</span></div>
                    <div class="flex justify-between py-2 border-b border-white/5"><span class="text-gray-400">Enrichment Rate</span><span class="text-emerald-400 font-semibold">${intel.enrichment_rate}%</span></div>
                    <div class="flex justify-between py-2 border-b border-white/5"><span class="text-gray-400">Email Coverage</span><span class="text-sky-400 font-semibold">${intel.email_rate}%</span></div>
                    <div class="flex justify-between py-2 border-b border-white/5"><span class="text-gray-400">Active Relationships</span><span class="text-green-400 font-semibold">${intel.active_relationships}</span></div>
                    <div class="flex justify-between py-2 border-b border-white/5"><span class="text-gray-400">Dormant/Lost</span><span class="text-red-400 font-semibold">${intel.dormant_relationships}</span></div>
                    <div class="flex justify-between py-2"><span class="text-gray-400">Industries Covered</span><span class="text-purple-400 font-semibold">${intel.industries_count}</span></div>
                `;
            }

            renderContacts(allContacts);
        }

        function renderContacts(contacts) {
            const body=document.getElementById('contacts-body');
            body.innerHTML=contacts.map(c=>`
                <tr class="row border-b border-white/[0.02] transition">
                    <td class="py-2 px-2 text-white font-medium">${c.name}${c.linkedin?` <a href="${c.linkedin}" target="_blank" class="text-cyan-500/50 text-[9px]">‚Üó</a>`:''}</td>
                    <td class="py-2 px-2 text-gray-400">${c.title||'‚Äî'}</td>
                    <td class="py-2 px-2 text-gray-400">${c.company||'‚Äî'}</td>
                    <td class="py-2 px-2"><span class="px-1.5 py-0.5 rounded text-[9px] bg-white/5">${c.classification}</span></td>
                    <td class="py-2 px-2">${scoreBadge(c.relationship_score)}</td>
                    <td class="py-2 px-2">${stageBadge(c.relationship_stage)}</td>
                    <td class="py-2 px-2 text-gray-400">${c.interaction_count||0}</td>
                    <td class="py-2 px-2 text-gray-500 text-[10px]">${c.email?'‚úÖ':'‚Äî'}</td>
                    <td class="py-2 px-2 text-gray-500 text-[10px]">${c.follow_up_date||'‚Äî'}</td>
                </tr>
            `).join('');
        }

        function filterContacts() {
            const q=document.getElementById('contact-search').value.toLowerCase();
            const filtered=allContacts.filter(c=>
                (c.name||'').toLowerCase().includes(q)||
                (c.company||'').toLowerCase().includes(q)||
                (c.industry||'').toLowerCase().includes(q)||
                (c.classification||'').toLowerCase().includes(q)
            );
            renderContacts(filtered);
        }

        async function loadIntros() {
            const data=await api('introductions');
            if(!data) return;
            
            const sc=data.status_counts||{};
            if(Object.keys(sc).length) {
                const sColors={suggested:C.blue+'80',requested:C.amber+'80',made:C.emerald+'80',declined:C.red+'80'};
                mkChart('ch-intro-status','doughnut',{labels:Object.keys(sc),datasets:[{data:Object.values(sc),backgroundColor:Object.keys(sc).map(s=>sColors[s]||C.purple+'80'),borderWidth:0}]},{cutout:'60%'});
            }

            const el=document.getElementById('intros-list');
            const intros=data.introductions||[];
            if(!intros.length){el.innerHTML='<p class="text-gray-600 text-xs">No introductions yet</p>';return;}
            el.innerHTML=intros.map(i=>{
                const emoji={suggested:'üí°',requested:'üì®',made:'‚úÖ',declined:'‚ùå'}[i.status]||'‚ùì';
                return `<div class="p-3 rounded-lg bg-white/[0.02] hover:bg-white/[0.04] transition">
                    <div class="flex items-center gap-2"><span>${emoji}</span><span class="text-white text-xs font-medium">${i.connector}</span><span class="text-gray-500">‚Üí</span><span class="text-white text-xs font-medium">${i.target}</span><span class="ml-auto text-[9px] text-gray-600">${i.date}</span></div>
                    ${i.reason?`<p class="text-[10px] text-gray-500 mt-1 ml-6">${i.reason}</p>`:''}
                </div>`;
            }).join('');
        }

        async function loadActivity() {
            const data=await api('interactions');
            if(!data) return;

            const tl=data.timeline||[];
            mkChart('ch-timeline','line',{labels:tl.map(t=>t.day.slice(5)),datasets:[{label:'Interactions',data:tl.map(t=>t.count),borderColor:C.cyan,backgroundColor:C.cyan+'15',fill:true,tension:0.4,pointRadius:2}]});

            const types=data.by_type||[];
            mkChart('ch-itypes','doughnut',{labels:types.map(t=>t.interaction_type),datasets:[{data:types.map(t=>t.count),backgroundColor:PAL,borderWidth:0}]},{cutout:'60%'});

            const tc=document.getElementById('top-contacts');
            const contacts=data.by_contact||[];
            if(!contacts.length){tc.innerHTML='<p class="text-gray-600 text-xs">No interactions yet</p>';return;}
            const max=contacts[0]?.interaction_count||1;
            tc.innerHTML=contacts.slice(0,10).map(c=>`
                <div class="flex items-center gap-3 py-1.5">
                    <span class="text-xs text-white w-32 truncate font-medium">${c.contact_name}</span>
                    <div class="flex-1 h-2 rounded-full bg-white/5"><div class="bar h-full rounded-full bg-gradient-to-r from-cyan-500 to-teal-500" style="width:${c.interaction_count/max*100}%"></div></div>
                    <span class="text-[10px] text-cyan-400 font-medium w-6 text-right">${c.interaction_count}</span>
                </div>
            `).join('');
        }

        async function loadFollowups() {
            const data=await api('interactions');
            if(!data) return;
            const el=document.getElementById('followups-list');
            const fus=(data.follow_ups||[]).filter(f=>!f.completed);
            if(!fus.length){el.innerHTML='<p class="text-gray-600 text-xs">No pending follow-ups ‚úÖ</p>';return;}
            
            const today=new Date().toISOString().slice(0,10);
            el.innerHTML=fus.map(f=>{
                const overdue=f.follow_up_date<today;
                const isToday=f.follow_up_date===today;
                const icon=overdue?'üî¥':isToday?'üî•':'üìå';
                const label=overdue?'OVERDUE':isToday?'TODAY':f.follow_up_date;
                return `<div class="flex items-center gap-3 p-3 rounded-lg bg-white/[0.02] hover:bg-white/[0.04] transition">
                    <span>${icon}</span>
                    <div class="flex-1">
                        <span class="text-white text-xs font-medium">${f.contact_name}</span>
                        ${f.reason?`<span class="text-gray-500 text-[10px] ml-2">${f.reason}</span>`:''}
                    </div>
                    <span class="text-[10px] ${overdue?'text-red-400':isToday?'text-amber-400':'text-gray-500'} font-medium">${label}</span>
                </div>`;
            }).join('');
        }

        async function refreshAll() {
            document.getElementById('status').textContent='Refreshing...';
            await Promise.all([loadHero(),loadNetwork(),loadIntros(),loadActivity(),loadFollowups()]);
            document.getElementById('status').textContent=`Updated ${new Date().toLocaleTimeString()}`;
        }

        refreshAll();
        setInterval(refreshAll,30000);
    </script>
</body>
</html>
